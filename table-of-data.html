<template id="table-of-data-template">
  <table class="table-of-data"></table>
  <style>
    table.table-of-data td, table.table-of-data th { border-bottom: 1px solid #ddd; text-align: left; }
    table.table-of-data { border-collapse: collapse; width: 100%; }
    table.table-of-data th, table.table-of-data td { padding: 8px; }
  </style>
</template>
<script type="text/javascript">
  let querySelector = function(selector) {
    //currentScript is this ^ script tag, and the owner is this document around it
    let script = document._currentScript || document.currentScript;
    //ownerDocument is this entire file
    return script ? script.ownerDocument.querySelector(selector) : document.querySelector(selector);
  };
  function isMarkDownURL(text) {
    let expression = /\[([-a-zA-Z0-9@:%_\+.~#?&//=\s]*)\]\((https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*))\)/g;
    return expression.test(text) ? true : false;
  }
  //querySelector only works at top level because currentScript is only valid there
  const template = querySelector('template#table-of-data-template');
  customElements.define('table-of-data', class extends HTMLElement {
    constructor() {//template setup
      super(); //always always
    }
    connectedCallback() {//event listeners
      const instance = template.content.cloneNode(true);
      this.appendChild(instance);
    }
    disconnectedCallback() {}//event cleanup
    attributeChangedCallback(name) {}//observed attribute changes
    set data(val) {
      this._refreshTable(val);
      this._data = val;
    }
    get data() { return (this._data || {}); }
    _refreshTable(data) {//add/refresh data to table
      let tableOfData = this.querySelector('.table-of-data');
      let frag = document.createDocumentFragment();
      let tableHeadingRow = document.createElement('tr');
      data.headings.forEach(heading => {
        let tableHeading = document.createElement('th');
        tableHeading.textContent = heading;
        tableHeadingRow.appendChild(tableHeading);
      });
      frag.appendChild(tableHeadingRow);
      data.rows.forEach(row => {
        let tableRow = document.createElement('tr');
        data.headings.forEach((name, i) => {
          let rowEl = document.createElement('td');
          if (isMarkDownURL(row[i])) {
            let a = document.createElement('a');
            a.href = row[i].split('](')[1].slice(0, -1);
            a.textContent = row[i].split('](')[0].slice(1);
            rowEl.appendChild(a);
          } else {
            rowEl.innerHTML = row[i];
          }
          tableRow.appendChild(rowEl);
        });
        frag.appendChild(tableRow);
      });
      tableOfData.innerHTML = '';//clear the table
      tableOfData.appendChild(frag);
    }
  });
</script>
