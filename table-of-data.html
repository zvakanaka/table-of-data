<template id="table-of-data-template">
  <table class="table-of-data">
  </table>
</template>
<script type="text/javascript">
  const CAN_SHADOW_DOM = !!HTMLElement.prototype.attachShadow;//V1
  let querySelector = function(selector) {
    //currentScript is this ^ script tag, and the owner is this document around it
    let script = document._currentScript || document.currentScript;
    return script ? script.ownerDocument.querySelector(selector) : document.querySelector(selector);
  };
  function isElementShadowRoot(el) {
    return !!(el.toString() === '[Object] ShadowRoot');
  }
  function isMarkDownURL(text) {
    let expression = /\[([-a-zA-Z0-9@:%_\+.~#?&//=\s]*)\]\((https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*))\)/g;
    if (expression.test(text)) return true;
    return false;
  }

  customElements.define('table-of-data', class extends HTMLElement {
    //template setup things here
    constructor() {
      var styleEl = document.createElement('style');
      styleEl.setAttribute('title', 'table-of-data');
      styleEl.setAttribute('type', 'text/css');
      let css = `.table-of-data td, .table-of-data th { border-bottom: 1px solid #ddd; text-align: left; } table.table-of-data { border-collapse: collapse; width: 100%; } table.table-of-data th, table.table-of-data td { padding: 8px; }`;
      if (styleEl.styleSheet) {
        styleEl.styleSheet.cssText = css;
      } else {
        styleEl.appendChild(document.createTextNode(css));
      }
      super(); //always always
      const t = querySelector('template#table-of-data-template');
      const instance = t.content.cloneNode(true);
      if (CAN_SHADOW_DOM) {
        let shadowRoot = this.attachShadow({mode: 'open'});
        shadowRoot.appendChild(instance);
        shadowRoot.appendChild(styleEl);
      } else {
        this.appendChild(instance);
        if (!document.querySelector('style[title="table-of-data"]')) {
          document.head.appendChild(styleEl);
        }
      }
    }
    //event listeners here
    attachedCallback() {
    }
    //event cleanup
    detachedCallback() {
    }
    //happens when an observedAttribute changes
    //react to attribute changes here
    attributeChangedCallback(name) {
    }
    attachTable(data) {
      this.data = data;
      let root = this;
      if (CAN_SHADOW_DOM) root = this.shadowRoot;
      let tableOfData = root.querySelector('table');
      tableOfData.innerHTML = '';
      let tableHeadingRow = document.createElement('tr');
      tableOfData.appendChild(tableHeadingRow);
      data.headings.forEach(heading => {
        let tableHeading = document.createElement('th');
        tableHeading.textContent = heading;
        tableOfData.appendChild(tableHeading);
      });
      data.rows.forEach(rowData => {
        let tableRow = document.createElement('tr');
        data.headings.forEach(column => {
          let rowEl = document.createElement('td');
          if (isMarkDownURL(rowData[column])) {
            let a = document.createElement('a');
            a.href = rowData[column].split('](')[1].slice(0,-1);
            a.textContent = rowData[column].split('](')[0].slice(1);
            rowEl.appendChild(a);
          } else {
            rowEl.textContent = rowData[column];
          }
          tableRow.appendChild(rowEl);
        });
        tableOfData.appendChild(tableRow);
      });
    }
  });
</script>
